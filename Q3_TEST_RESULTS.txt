============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.4.2, pluggy-1.6.0 -- C:\Users\User\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow
configfile: pytest.ini
plugins: anyio-4.12.1, asyncio-0.24.0, cov-5.0.0
asyncio: mode=Mode.AUTO, default_loop_scope=None
collecting ... collected 607 items

tests/unit/repositories/test_ai_memory_repository.py::test_get_or_create_returns_existing PASSED [  0%]
tests/unit/repositories/test_ai_memory_repository.py::test_get_or_create_creates_new PASSED [  0%]
tests/unit/repositories/test_ai_memory_repository.py::test_update_preferences_merges_without_data_loss PASSED [  0%]
tests/unit/repositories/test_ai_memory_repository.py::test_set_preference_single_key PASSED [  0%]
tests/unit/repositories/test_ai_memory_repository.py::test_get_preferences_returns_empty_dict_for_new_user PASSED [  0%]
tests/unit/repositories/test_ai_memory_repository.py::test_add_team_member_creates_entry PASSED [  0%]
tests/unit/repositories/test_ai_memory_repository.py::test_add_team_member_updates_existing PASSED [  1%]
tests/unit/repositories/test_ai_memory_repository.py::test_find_team_member_exact_match PASSED [  1%]
tests/unit/repositories/test_ai_memory_repository.py::test_find_team_member_partial_match PASSED [  1%]
tests/unit/repositories/test_ai_memory_repository.py::test_find_team_member_returns_none_if_not_found PASSED [  1%]
tests/unit/repositories/test_ai_memory_repository.py::test_add_trigger_creates_pattern PASSED [  1%]
tests/unit/repositories/test_ai_memory_repository.py::test_match_trigger_finds_pattern PASSED [  1%]
tests/unit/repositories/test_ai_memory_repository.py::test_match_trigger_returns_none_if_no_match PASSED [  2%]
tests/unit/repositories/test_ai_memory_repository.py::test_update_context_merges_data PASSED [  2%]
tests/unit/repositories/test_ai_memory_repository.py::test_update_context_adds_timestamp PASSED [  2%]
tests/unit/repositories/test_ai_memory_repository.py::test_clear_context_empties_context PASSED [  2%]
tests/unit/repositories/test_ai_memory_repository.py::test_record_pattern_appends_to_list PASSED [  2%]
tests/unit/repositories/test_ai_memory_repository.py::test_get_common_default_returns_most_frequent PASSED [  2%]
tests/unit/repositories/test_ai_memory_repository.py::test_get_common_default_returns_none_if_no_patterns PASSED [  3%]
tests/unit/repositories/test_ai_memory_repository.py::test_increment_stats_updates_counters PASSED [  3%]
tests/unit/repositories/test_ai_memory_repository.py::test_get_full_context_for_ai_returns_complete_data PASSED [  3%]
tests/unit/repositories/test_audit_repository.py::test_log_creates_audit_entry PASSED [  3%]
tests/unit/repositories/test_audit_repository.py::test_log_handles_dict_values PASSED [  3%]
tests/unit/repositories/test_audit_repository.py::test_log_stores_metadata_correctly PASSED [  3%]
tests/unit/repositories/test_audit_repository.py::test_log_handles_errors_gracefully PASSED [  4%]
tests/unit/repositories/test_audit_repository.py::test_create_makes_comprehensive_audit_log PASSED [  4%]
tests/unit/repositories/test_audit_repository.py::test_create_uses_system_if_no_user_id PASSED [  4%]
tests/unit/repositories/test_audit_repository.py::test_create_accepts_custom_timestamp PASSED [  4%]
tests/unit/repositories/test_audit_repository.py::test_query_filters_by_action PASSED [  4%]
tests/unit/repositories/test_audit_repository.py::test_query_filters_by_user_id PASSED [  4%]
tests/unit/repositories/test_audit_repository.py::test_query_filters_by_entity_type PASSED [  5%]
tests/unit/repositories/test_audit_repository.py::test_query_supports_pagination PASSED [  5%]
tests/unit/repositories/test_audit_repository.py::test_query_returns_empty_list_if_no_results PASSED [  5%]
tests/unit/repositories/test_audit_repository.py::test_count_returns_total PASSED [  5%]
tests/unit/repositories/test_audit_repository.py::test_count_returns_zero_if_none PASSED [  5%]
tests/unit/repositories/test_audit_repository.py::test_log_task_created_captures_metadata PASSED [  5%]
tests/unit/repositories/test_audit_repository.py::test_log_status_change_records_transition PASSED [  6%]
tests/unit/repositories/test_audit_repository.py::test_log_approval_stores_message PASSED [  6%]
tests/unit/repositories/test_audit_repository.py::test_log_rejection_stores_feedback PASSED [  6%]
tests/unit/repositories/test_audit_repository.py::test_get_task_history_returns_chronological PASSED [  6%]
tests/unit/repositories/test_audit_repository.py::test_get_user_activity_filters_by_date PASSED [  6%]
tests/unit/repositories/test_audit_repository.py::test_get_recent_logs_limits_results PASSED [  6%]
tests/unit/repositories/test_audit_repository.py::test_get_recent_logs_filters_by_action PASSED [  7%]
tests/unit/repositories/test_audit_repository.py::test_get_activity_stats_aggregates_data PASSED [  7%]
tests/unit/repositories/test_conversations_repository.py::test_create_conversation_success PASSED [  7%]
tests/unit/repositories/test_conversations_repository.py::test_create_conversation_minimal_fields PASSED [  7%]
tests/unit/repositories/test_conversations_repository.py::test_create_conversation_error_handling FAILED [  7%]
tests/unit/repositories/test_conversations_repository.py::test_get_by_id_found PASSED [  7%]
tests/unit/repositories/test_conversations_repository.py::test_get_by_id_not_found PASSED [  8%]
tests/unit/repositories/test_conversations_repository.py::test_get_active_for_user_found PASSED [  8%]
tests/unit/repositories/test_conversations_repository.py::test_get_active_for_user_not_found PASSED [  8%]
tests/unit/repositories/test_conversations_repository.py::test_get_user_history PASSED [  8%]
tests/unit/repositories/test_conversations_repository.py::test_get_recent_conversations PASSED [  8%]
tests/unit/repositories/test_conversations_repository.py::test_update_stage PASSED [  8%]
tests/unit/repositories/test_conversations_repository.py::test_update_stage_with_spec PASSED [  9%]
tests/unit/repositories/test_conversations_repository.py::test_complete_conversation PASSED [  9%]
tests/unit/repositories/test_conversations_repository.py::test_complete_conversation_cancelled PASSED [  9%]
tests/unit/repositories/test_conversations_repository.py::test_clear_user_conversations PASSED [  9%]
tests/unit/repositories/test_conversations_repository.py::test_clear_user_conversations_none_active PASSED [  9%]
tests/unit/repositories/test_conversations_repository.py::test_get_stale_conversations PASSED [  9%]
tests/unit/repositories/test_conversations_repository.py::test_cleanup_stale_conversations PASSED [ 10%]
tests/unit/repositories/test_conversations_repository.py::test_cleanup_stale_none_found PASSED [ 10%]
tests/unit/repositories/test_conversations_repository.py::test_add_message_success PASSED [ 10%]
tests/unit/repositories/test_conversations_repository.py::test_add_message_with_intent PASSED [ 10%]
tests/unit/repositories/test_conversations_repository.py::test_add_message_conversation_not_found FAILED [ 10%]
tests/unit/repositories/test_conversations_repository.py::test_get_messages PASSED [ 10%]
tests/unit/repositories/test_conversations_repository.py::test_get_messages_conversation_not_found PASSED [ 11%]
tests/unit/repositories/test_conversations_repository.py::test_get_stats PASSED [ 11%]
tests/unit/repositories/test_conversations_repository.py::test_get_stats_no_conversations PASSED [ 11%]
tests/unit/repositories/test_oauth_repository.py::test_store_token_encrypts_tokens PASSED [ 11%]
tests/unit/repositories/test_oauth_repository.py::test_store_token_updates_existing PASSED [ 11%]
tests/unit/repositories/test_oauth_repository.py::test_store_token_handles_expiry PASSED [ 11%]
tests/unit/repositories/test_oauth_repository.py::test_get_token_decrypts_successfully PASSED [ 12%]
tests/unit/repositories/test_oauth_repository.py::test_get_token_returns_none_if_missing PASSED [ 12%]
tests/unit/repositories/test_oauth_repository.py::test_get_token_backward_compatibility_plaintext PASSED [ 12%]
tests/unit/repositories/test_oauth_repository.py::test_get_token_logs_audit_event PASSED [ 12%]
tests/unit/repositories/test_oauth_repository.py::test_update_access_token_encrypts PASSED [ 12%]
tests/unit/repositories/test_oauth_repository.py::test_update_access_token_returns_false_if_missing PASSED [ 12%]
tests/unit/repositories/test_oauth_repository.py::test_delete_token_success PASSED [ 13%]
tests/unit/repositories/test_oauth_repository.py::test_delete_token_handles_missing PASSED [ 13%]
tests/unit/repositories/test_oauth_repository.py::test_has_token_returns_true_if_exists PASSED [ 13%]
tests/unit/repositories/test_oauth_repository.py::test_has_token_returns_false_if_missing PASSED [ 13%]
tests/unit/repositories/test_oauth_repository.py::test_get_refresh_token_extracts_correctly PASSED [ 13%]
tests/unit/repositories/test_oauth_repository.py::test_get_refresh_token_returns_none_if_missing PASSED [ 13%]
tests/unit/repositories/test_projects_repository.py::test_create_project_success PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_create_project_minimal_fields PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_create_project_error_handling PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_get_by_id_found PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_get_by_id_not_found PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_get_by_name_found PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_get_by_name_not_found PASSED [ 14%]
tests/unit/repositories/test_projects_repository.py::test_get_all_projects PASSED [ 15%]
tests/unit/repositories/test_projects_repository.py::test_get_all_filtered_by_status PASSED [ 15%]
tests/unit/repositories/test_projects_repository.py::test_get_active_projects PASSED [ 15%]
tests/unit/repositories/test_projects_repository.py::test_update_project_success PASSED [ 15%]
tests/unit/repositories/test_projects_repository.py::test_update_adds_timestamp PASSED [ 15%]
tests/unit/repositories/test_projects_repository.py::test_archive_project PASSED [ 15%]
tests/unit/repositories/test_projects_repository.py::test_complete_project PASSED [ 16%]
tests/unit/repositories/test_projects_repository.py::test_delete_project_unassigns_tasks PASSED [ 16%]
tests/unit/repositories/test_projects_repository.py::test_delete_project_sets_needs_sync PASSED [ 16%]
tests/unit/repositories/test_projects_repository.py::test_get_project_stats_empty_project PASSED [ 16%]
tests/unit/repositories/test_projects_repository.py::test_get_project_stats_with_tasks PASSED [ 16%]
tests/unit/repositories/test_projects_repository.py::test_get_project_stats_nonexistent_project PASSED [ 16%]
tests/unit/repositories/test_projects_repository.py::test_get_all_stats_multiple_projects PASSED [ 17%]
tests/unit/repositories/test_projects_repository.py::test_get_all_stats_no_active_projects PASSED [ 17%]
tests/unit/repositories/test_projects_repository.py::test_find_or_create_existing_project PASSED [ 17%]
tests/unit/repositories/test_projects_repository.py::test_find_or_create_new_project PASSED [ 17%]
tests/unit/repositories/test_projects_repository.py::test_find_or_create_idempotency PASSED [ 17%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_daily PASSED [ 17%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_weekday PASSED [ 18%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_single_day PASSED [ 18%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_multiple_days PASSED [ 18%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_monthly_first PASSED [ 18%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_monthly_15th PASSED [ 18%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_monthly_last PASSED [ 18%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_interval_days PASSED [ 19%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_interval_weeks PASSED [ 19%]
tests/unit/repositories/test_recurring_repository.py::test_parse_pattern_with_every_prefix PASSED [ 19%]
tests/unit/repositories/test_recurring_repository.py::test_parse_time_24h_format PASSED [ 19%]
tests/unit/repositories/test_recurring_repository.py::test_parse_time_12h_am PASSED [ 19%]
tests/unit/repositories/test_recurring_repository.py::test_parse_time_12h_pm PASSED [ 19%]
tests/unit/repositories/test_recurring_repository.py::test_parse_time_noon PASSED [ 20%]
tests/unit/repositories/test_recurring_repository.py::test_parse_time_midnight PASSED [ 20%]
tests/unit/repositories/test_recurring_repository.py::test_parse_time_with_minutes PASSED [ 20%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_daily PASSED [ 20%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_daily_future_today PASSED [ 20%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_weekday PASSED [ 20%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_weekly PASSED [ 21%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_monthly_specific_day PASSED [ 21%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_monthly_past_day PASSED [ 21%]
tests/unit/repositories/test_recurring_repository.py::test_calculate_next_run_interval PASSED [ 21%]
tests/unit/repositories/test_recurring_repository.py::test_is_valid_pattern_valid_patterns PASSED [ 21%]
tests/unit/repositories/test_recurring_repository.py::test_is_valid_pattern_handles_errors PASSED [ 21%]
tests/unit/repositories/test_recurring_repository.py::test_create_recurring_task_success PASSED [ 22%]
tests/unit/repositories/test_recurring_repository.py::test_create_recurring_task_generates_id PASSED [ 22%]
tests/unit/repositories/test_recurring_repository.py::test_create_recurring_task_calculates_next_run PASSED [ 22%]
tests/unit/repositories/test_recurring_repository.py::test_get_by_id_found PASSED [ 22%]
tests/unit/repositories/test_recurring_repository.py::test_get_by_id_not_found PASSED [ 22%]
tests/unit/repositories/test_recurring_repository.py::test_get_active PASSED [ 22%]
tests/unit/repositories/test_recurring_repository.py::test_get_due_now PASSED [ 23%]
tests/unit/repositories/test_recurring_repository.py::test_get_all PASSED [ 23%]
tests/unit/repositories/test_recurring_repository.py::test_update_after_run FAILED [ 23%]
tests/unit/repositories/test_recurring_repository.py::test_update_after_run_not_found FAILED [ 23%]
tests/unit/repositories/test_recurring_repository.py::test_pause_recurring_task FAILED [ 23%]
tests/unit/repositories/test_recurring_repository.py::test_pause_not_found FAILED [ 23%]
tests/unit/repositories/test_recurring_repository.py::test_resume_recurring_task FAILED [ 24%]
tests/unit/repositories/test_recurring_repository.py::test_resume_recalculates_next_run PASSED [ 24%]
tests/unit/repositories/test_recurring_repository.py::test_resume_not_found FAILED [ 24%]
tests/unit/repositories/test_recurring_repository.py::test_delete_recurring_task PASSED [ 24%]
tests/unit/repositories/test_recurring_repository.py::test_delete_not_found FAILED [ 24%]
tests/unit/repositories/test_task_repository.py::test_create_task_success PASSED [ 24%]
tests/unit/repositories/test_task_repository.py::test_create_task_duplicate_id FAILED [ 25%]
tests/unit/repositories/test_task_repository.py::test_get_by_task_id_found PASSED [ 25%]
tests/unit/repositories/test_task_repository.py::test_get_by_task_id_not_found PASSED [ 25%]
tests/unit/repositories/test_task_repository.py::test_get_by_status PASSED [ 25%]
tests/unit/repositories/test_task_repository.py::test_get_by_assignee PASSED [ 25%]
tests/unit/repositories/test_task_repository.py::test_update_task_success PASSED [ 25%]
tests/unit/repositories/test_task_repository.py::test_update_task_not_found FAILED [ 26%]
tests/unit/repositories/test_task_repository.py::test_update_task_with_empty_updates PASSED [ 26%]
tests/unit/repositories/test_task_repository.py::test_delete_task_success PASSED [ 26%]
tests/unit/repositories/test_task_repository.py::test_delete_task_not_found FAILED [ 26%]
tests/unit/repositories/test_task_repository.py::test_add_subtask_success PASSED [ 26%]
tests/unit/repositories/test_task_repository.py::test_add_subtask_parent_not_found PASSED [ 26%]
tests/unit/repositories/test_task_repository.py::test_add_dependency_success PASSED [ 27%]
tests/unit/repositories/test_task_repository.py::test_add_dependency_task_not_found PASSED [ 27%]
tests/unit/repositories/test_task_repository.py::test_get_overdue_tasks PASSED [ 27%]
tests/unit/repositories/test_task_repository.py::test_concurrent_updates PASSED [ 27%]
tests/unit/repositories/test_task_repository.py::test_change_status_to_completed_sets_timestamp PASSED [ 27%]
tests/unit/repositories/test_task_repository.py::test_change_status_to_in_progress_sets_started_at PASSED [ 27%]
tests/unit/repositories/test_task_repository.py::test_change_status_to_delayed_tracks_reason PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_change_status_task_not_found PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_complete_subtask_updates_progress PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_complete_subtask_not_found PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_assign_to_project_success PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_remove_from_project_success PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_get_all_with_pagination PASSED [ 28%]
tests/unit/repositories/test_task_repository.py::test_get_all_default_pagination PASSED [ 29%]
tests/unit/repositories/test_task_repository.py::test_get_recent_returns_latest_tasks PASSED [ 29%]
tests/unit/repositories/test_task_repository.py::test_get_due_soon_within_24_hours PASSED [ 29%]
tests/unit/repositories/test_task_repository.py::test_get_due_soon_custom_hours PASSED [ 29%]
tests/unit/repositories/test_task_repository.py::test_get_by_project_returns_tasks PASSED [ 29%]
tests/unit/repositories/test_task_repository.py::test_get_by_project_empty PASSED [ 29%]
tests/unit/repositories/test_task_repository.py::test_get_pending_sync PASSED [ 30%]
tests/unit/repositories/test_task_repository.py::test_mark_synced_updates_tasks PASSED [ 30%]
tests/unit/repositories/test_task_repository.py::test_get_daily_stats_returns_counts PASSED [ 30%]
tests/unit/repositories/test_task_repository.py::test_get_daily_stats_handles_null PASSED [ 30%]
tests/unit/repositories/test_task_repository.py::test_get_subtasks_returns_ordered_list PASSED [ 30%]
tests/unit/repositories/test_task_repository.py::test_get_subtasks_task_not_found PASSED [ 30%]
tests/unit/repositories/test_task_repository.py::test_would_create_cycle_detects_direct_cycle PASSED [ 31%]
tests/unit/repositories/test_task_repository.py::test_would_create_cycle_no_cycle PASSED [ 31%]
tests/unit/repositories/test_task_repository.py::test_would_create_cycle_complex_chain PASSED [ 31%]
tests/unit/repositories/test_task_repository.py::test_get_singleton_returns_same_instance PASSED [ 31%]
tests/unit/repositories/test_task_repository.py::test_get_singleton_creates_instance_on_first_call PASSED [ 31%]
tests/unit/repositories/test_team_repository.py::test_create_team_member_success PASSED [ 31%]
tests/unit/repositories/test_team_repository.py::test_create_logs_audit_event PASSED [ 32%]
tests/unit/repositories/test_team_repository.py::test_create_generates_username PASSED [ 32%]
tests/unit/repositories/test_team_repository.py::test_create_handles_errors_gracefully PASSED [ 32%]
tests/unit/repositories/test_team_repository.py::test_update_team_member_success PASSED [ 32%]
tests/unit/repositories/test_team_repository.py::test_update_logs_audit_event PASSED [ 32%]
tests/unit/repositories/test_team_repository.py::test_update_adds_timestamp PASSED [ 32%]
tests/unit/repositories/test_team_repository.py::test_delete_team_member_success PASSED [ 33%]
tests/unit/repositories/test_team_repository.py::test_delete_logs_audit_event_with_warning_level PASSED [ 33%]
tests/unit/repositories/test_team_repository.py::test_delete_handles_missing_member PASSED [ 33%]
tests/unit/repositories/test_team_repository.py::test_find_member_by_name PASSED [ 33%]
tests/unit/repositories/test_team_repository.py::test_find_member_by_username PASSED [ 33%]
tests/unit/repositories/test_team_repository.py::test_find_member_by_telegram_id PASSED [ 33%]
tests/unit/repositories/test_team_repository.py::test_find_member_by_discord_username PASSED [ 34%]
tests/unit/repositories/test_team_repository.py::test_find_member_by_email PASSED [ 34%]
tests/unit/repositories/test_team_repository.py::test_find_member_returns_none_if_not_found PASSED [ 34%]
tests/unit/repositories/test_team_repository.py::test_find_member_strips_at_symbol PASSED [ 34%]
tests/unit/repositories/test_team_repository.py::test_increment_assigned_updates_counter PASSED [ 34%]
tests/unit/repositories/test_team_repository.py::test_increment_completed_updates_counter PASSED [ 34%]
tests/unit/repositories/test_team_repository.py::test_get_performance_stats_calculates_completion_rate PASSED [ 35%]
tests/unit/repositories/test_team_repository.py::test_get_performance_stats_handles_zero_assigned PASSED [ 35%]
tests/unit/repositories/test_team_repository.py::test_deactivate_sets_is_active_false PASSED [ 35%]
tests/unit/repositories/test_team_repository.py::test_activate_sets_is_active_true PASSED [ 35%]
tests/unit/repositories/test_team_repository.py::test_get_all_filters_active_only PASSED [ 35%]
tests/unit/repositories/test_team_repository.py::test_get_all_returns_all_if_active_only_false PASSED [ 35%]
tests/unit/repositories/test_team_repository.py::test_get_by_role_filters_correctly PASSED [ 36%]
tests/unit/repositories/test_team_repository.py::test_get_by_skill_filters_correctly PASSED [ 36%]
tests/unit/test_api_routes.py::TestHealthAndInfo::test_root_endpoint PASSED [ 36%]
tests/unit/test_api_routes.py::TestHealthAndInfo::test_health_endpoint PASSED [ 36%]
tests/unit/test_api_routes.py::TestHealthAndInfo::test_health_endpoint_with_discord PASSED [ 36%]
tests/unit/test_api_routes.py::TestHealthAndInfo::test_db_health_endpoint PASSED [ 36%]
tests/unit/test_api_routes.py::TestHealthAndInfo::test_db_health_not_initialized PASSED [ 37%]
tests/unit/test_api_routes.py::TestTaskAPI::test_get_all_tasks PASSED    [ 37%]
tests/unit/test_api_routes.py::TestTaskAPI::test_get_tasks_with_status_filter PASSED [ 37%]
tests/unit/test_api_routes.py::TestTaskAPI::test_get_tasks_with_assignee_filter PASSED [ 37%]
tests/unit/test_api_routes.py::TestTaskAPI::test_get_tasks_pagination PASSED [ 37%]
tests/unit/test_api_routes.py::TestTaskAPI::test_get_task_by_id PASSED   [ 37%]
tests/unit/test_api_routes.py::TestTaskAPI::test_get_task_not_found PASSED [ 38%]
tests/unit/test_api_routes.py::TestTaskAPI::test_add_subtask PASSED      [ 38%]
tests/unit/test_api_routes.py::TestTaskAPI::test_add_subtask_invalid_data PASSED [ 38%]
tests/unit/test_api_routes.py::TestTaskAPI::test_add_dependency PASSED   [ 38%]
tests/unit/test_api_routes.py::TestTaskAPI::test_add_dependency_invalid_task_id PASSED [ 38%]
tests/unit/test_api_routes.py::TestAdminAPI::test_run_migration_simple_requires_auth PASSED [ 38%]
tests/unit/test_api_routes.py::TestAdminAPI::test_run_migration_requires_auth PASSED [ 39%]
tests/unit/test_api_routes.py::TestAdminAPI::test_seed_test_team_requires_auth PASSED [ 39%]
tests/unit/test_api_routes.py::TestAdminAPI::test_clear_conversations_requires_auth PASSED [ 39%]
tests/unit/test_api_routes.py::TestAdminAPI::test_backup_oauth_tokens PASSED [ 39%]
tests/unit/test_api_routes.py::TestAdminAPI::test_encrypt_oauth_tokens PASSED [ 39%]
tests/unit/test_api_routes.py::TestAdminAPI::test_verify_oauth_encryption PASSED [ 39%]
tests/unit/test_api_routes.py::TestAdminAPI::test_trigger_sync PASSED    [ 40%]
tests/unit/test_api_routes.py::TestAdminAPI::test_get_db_stats PASSED    [ 40%]
tests/unit/test_api_routes.py::TestAuditAPI::test_get_task_audit PASSED  [ 40%]
tests/unit/test_api_routes.py::TestAuditAPI::test_query_audit_logs PASSED [ 40%]
tests/unit/test_api_routes.py::TestProjectAPI::test_get_projects PASSED  [ 40%]
tests/unit/test_api_routes.py::TestProjectAPI::test_create_project PASSED [ 40%]
tests/unit/test_api_routes.py::TestProjectAPI::test_create_project_invalid_color PASSED [ 41%]
tests/unit/test_api_routes.py::TestProjectAPI::test_create_project_xss_prevention PASSED [ 41%]
tests/unit/test_api_routes.py::TestWebhookRoutes::test_telegram_webhook PASSED [ 41%]
tests/unit/test_api_routes.py::TestWebhookRoutes::test_telegram_webhook_invalid_update_id PASSED [ 41%]
tests/unit/test_api_routes.py::TestWebhookRoutes::test_telegram_webhook_duplicate PASSED [ 41%]
tests/unit/test_api_routes.py::TestWebhookRoutes::test_discord_webhook PASSED [ 41%]
tests/unit/test_api_routes.py::TestOtherAPI::test_get_status PASSED      [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_trigger_job PASSED     [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_trigger_job_not_found PASSED [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_get_daily_tasks PASSED [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_get_overdue_tasks PASSED [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_get_weekly_overview PASSED [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_teach_preference PASSED [ 42%]
tests/unit/test_api_routes.py::TestOtherAPI::test_teach_preference_invalid_text PASSED [ 43%]
tests/unit/test_api_routes.py::TestOtherAPI::test_get_user_preferences PASSED [ 43%]
tests/unit/test_api_routes.py::TestErrorHandling::test_validation_error_handler PASSED [ 43%]
tests/unit/test_api_routes.py::TestErrorHandling::test_invalid_json PASSED [ 43%]
tests/unit/test_api_routes.py::TestErrorHandling::test_missing_required_field PASSED [ 43%]
tests/unit/test_api_routes.py::TestErrorHandling::test_internal_server_error PASSED [ 43%]
tests/unit/test_api_validation.py::TestSubtaskCreate::test_valid_subtask PASSED [ 44%]
tests/unit/test_api_validation.py::TestSubtaskCreate::test_title_too_short PASSED [ 44%]
tests/unit/test_api_validation.py::TestSubtaskCreate::test_title_too_long PASSED [ 44%]
tests/unit/test_api_validation.py::TestSubtaskCreate::test_description_too_long PASSED [ 44%]
tests/unit/test_api_validation.py::TestSubtaskCreate::test_optional_description PASSED [ 44%]
tests/unit/test_api_validation.py::TestDependencyCreate::test_valid_dependency PASSED [ 44%]
tests/unit/test_api_validation.py::TestDependencyCreate::test_invalid_task_id_format PASSED [ 45%]
tests/unit/test_api_validation.py::TestDependencyCreate::test_default_type PASSED [ 45%]
tests/unit/test_api_validation.py::TestDependencyCreate::test_enum_types PASSED [ 45%]
tests/unit/test_api_validation.py::TestTaskFilter::test_valid_filter PASSED [ 45%]
tests/unit/test_api_validation.py::TestTaskFilter::test_limit_bounds PASSED [ 45%]
tests/unit/test_api_validation.py::TestTaskFilter::test_offset_bounds PASSED [ 45%]
tests/unit/test_api_validation.py::TestTaskFilter::test_default_values PASSED [ 46%]
tests/unit/test_api_validation.py::TestAdminAuthRequest::test_valid_secret PASSED [ 46%]
tests/unit/test_api_validation.py::TestAdminAuthRequest::test_empty_secret PASSED [ 46%]
tests/unit/test_api_validation.py::TestTeamMemberCreate::test_valid_member PASSED [ 46%]
tests/unit/test_api_validation.py::TestTeamMemberCreate::test_invalid_role PASSED [ 46%]
tests/unit/test_api_validation.py::TestTeamMemberCreate::test_invalid_telegram_id PASSED [ 46%]
tests/unit/test_api_validation.py::TestTeamMemberCreate::test_invalid_discord_id PASSED [ 47%]
tests/unit/test_api_validation.py::TestTeamMemberCreate::test_default_active PASSED [ 47%]
tests/unit/test_api_validation.py::TestTeachingRequest::test_valid_teaching PASSED [ 47%]
tests/unit/test_api_validation.py::TestTeachingRequest::test_too_short PASSED [ 47%]
tests/unit/test_api_validation.py::TestTeachingRequest::test_too_long PASSED [ 47%]
tests/unit/test_api_validation.py::TestTeachingRequest::test_whitespace_stripping PASSED [ 47%]
tests/unit/test_api_validation.py::TestTriggerJobRequest::test_valid_job_id PASSED [ 48%]
tests/unit/test_api_validation.py::TestTriggerJobRequest::test_invalid_job_id PASSED [ 48%]
tests/unit/test_api_validation.py::TestTriggerJobRequest::test_default_force PASSED [ 48%]
tests/unit/test_api_validation.py::TestOnboardingDataEnhanced::test_valid_onboarding PASSED [ 48%]
tests/unit/test_api_validation.py::TestOnboardingDataEnhanced::test_xss_prevention PASSED [ 48%]
tests/unit/test_api_validation.py::TestOnboardingDataEnhanced::test_invalid_email PASSED [ 48%]
tests/unit/test_api_validation.py::TestOnboardingDataEnhanced::test_name_too_short PASSED [ 49%]
tests/unit/test_api_validation.py::TestOAuthCallback::test_valid_callback PASSED [ 49%]
tests/unit/test_api_validation.py::TestOAuthCallback::test_code_too_short PASSED [ 49%]
tests/unit/test_api_validation.py::TestOAuthCallback::test_invalid_state_format PASSED [ 49%]
tests/unit/test_api_validation.py::TestOAuthCallback::test_xss_prevention_in_error PASSED [ 49%]
tests/unit/test_api_validation.py::TestTelegramUpdate::test_valid_update PASSED [ 49%]
tests/unit/test_api_validation.py::TestTelegramUpdate::test_negative_update_id PASSED [ 50%]
tests/unit/test_api_validation.py::TestTelegramUpdate::test_zero_update_id PASSED [ 50%]
tests/unit/test_api_validation.py::TestDiscordWebhookPayload::test_valid_payload PASSED [ 50%]
tests/unit/test_api_validation.py::TestDiscordWebhookPayload::test_invalid_type_range PASSED [ 50%]
tests/unit/test_api_validation.py::TestDiscordWebhookPayload::test_invalid_id_format PASSED [ 50%]
tests/unit/test_api_validation.py::TestProjectCreate::test_valid_project PASSED [ 50%]
tests/unit/test_api_validation.py::TestProjectCreate::test_name_too_short PASSED [ 51%]
tests/unit/test_api_validation.py::TestProjectCreate::test_name_too_long PASSED [ 51%]
tests/unit/test_api_validation.py::TestProjectCreate::test_name_whitespace_only PASSED [ 51%]
tests/unit/test_api_validation.py::TestProjectCreate::test_xss_prevention_in_name PASSED [ 51%]
tests/unit/test_api_validation.py::TestProjectCreate::test_xss_prevention_in_description PASSED [ 51%]
tests/unit/test_api_validation.py::TestProjectCreate::test_invalid_color_format PASSED [ 51%]
tests/unit/test_api_validation.py::TestProjectCreate::test_valid_color_formats PASSED [ 52%]
tests/unit/test_api_validation.py::TestProjectCreate::test_optional_fields PASSED [ 52%]
tests/unit/test_api_validation.py::TestProjectCreate::test_description_max_length PASSED [ 52%]
tests/unit/test_approval_handler.py::test_can_handle_yes_response PASSED [ 52%]
tests/unit/test_approval_handler.py::test_can_handle_no_pending PASSED   [ 52%]
tests/unit/test_approval_handler.py::test_can_handle_non_confirmation PASSED [ 52%]
tests/unit/test_approval_handler.py::test_request_approval PASSED        [ 53%]
tests/unit/test_approval_handler.py::test_is_expired_not_expired PASSED  [ 53%]
tests/unit/test_approval_handler.py::test_is_expired_expired PASSED      [ 53%]
tests/unit/test_approval_handler.py::test_handle_no_pending_action PASSED [ 53%]
tests/unit/test_approval_handler.py::test_handle_expired_action PASSED   [ 53%]
tests/unit/test_approval_handler.py::test_handle_approval_clear_tasks PASSED [ 53%]
tests/unit/test_approval_handler.py::test_handle_rejection PASSED        [ 54%]
tests/unit/test_approval_handler.py::test_execute_delete_task PASSED     [ 54%]
tests/unit/test_approval_handler.py::test_execute_bulk_update PASSED     [ 54%]
tests/unit/test_base_handler.py::test_can_handle PASSED                  [ 54%]
tests/unit/test_base_handler.py::test_get_user_info PASSED               [ 54%]
tests/unit/test_base_handler.py::test_send_message PASSED                [ 54%]
tests/unit/test_base_handler.py::test_send_error PASSED                  [ 55%]
tests/unit/test_base_handler.py::test_send_success PASSED                [ 55%]
tests/unit/test_base_handler.py::test_format_task PASSED                 [ 55%]
tests/unit/test_base_handler.py::test_truncate PASSED                    [ 55%]
tests/unit/test_base_handler.py::test_is_boss PASSED                     [ 55%]
tests/unit/test_base_handler.py::test_get_user_permissions PASSED        [ 55%]
tests/unit/test_base_handler.py::test_session_management PASSED          [ 56%]
tests/unit/test_base_handler.py::test_log_action PASSED                  [ 56%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_initialize_success PASSED [ 56%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_initialize_failure PASSED [ 56%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_create_task_event_success PASSED [ 56%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_create_task_event_no_deadline PASSED [ 56%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_create_task_event_calendar_not_found PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_update_task_event_success PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_update_task_event_create_if_missing PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_update_task_event_delete_if_no_deadline PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_delete_task_event_success PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_delete_task_event_already_deleted PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_get_upcoming_deadlines PASSED [ 57%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_create_reminder_event PASSED [ 58%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_get_daily_schedule PASSED [ 58%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_with_high_priority PASSED [ 58%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_with_urgent_priority PASSED [ 58%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_with_overdue_status PASSED [ 58%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_with_delayed_status PASSED [ 58%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_includes_acceptance_criteria PASSED [ 59%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_get_assignee_info_from_sheets PASSED [ 59%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_get_assignee_info_not_found PASSED [ 59%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_extract_task_id_from_description PASSED [ 59%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_extract_task_id_no_match PASSED [ 59%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_set_calendar_id PASSED [ 59%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_estimated_effort_hours PASSED [ 60%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_estimated_effort_days PASSED [ 60%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_includes_pinned_notes PASSED [ 60%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_build_event_body_includes_attendee PASSED [ 60%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_create_task_event_uses_assignee_calendar PASSED [ 60%]
tests/unit/test_calendar_integration.py::TestGoogleCalendarIntegration::test_update_event_not_found_creates_new PASSED [ 60%]
tests/unit/test_command_handler.py::TestCommandHandler::test_can_handle_slash_command PASSED [ 61%]
tests/unit/test_command_handler.py::TestCommandHandler::test_can_handle_command_with_args PASSED [ 61%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cannot_handle_non_command PASSED [ 61%]
tests/unit/test_command_handler.py::TestCommandHandler::test_handle_unknown_command PASSED [ 61%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_start PASSED [ 61%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_help PASSED [ 61%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_cancel PASSED [ 62%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_status_with_task_id PASSED [ 62%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_status_task_not_found PASSED [ 62%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_approve_no_args PASSED [ 62%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_search_no_args PASSED [ 62%]
tests/unit/test_command_handler.py::TestCommandHandler::test_handle_command_execution_error PASSED [ 62%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_task_no_args PASSED [ 63%]
tests/unit/test_command_handler.py::TestCommandHandler::test_cmd_task_with_args PASSED [ 63%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_analyze_task_request_success PASSED [ 63%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_analyze_task_request_parse_error PASSED [ 63%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_generate_clarifying_questions PASSED [ 63%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_generate_task_spec_success PASSED [ 63%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_generate_task_spec_detailed_mode PASSED [ 64%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_process_answer PASSED [ 64%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_generate_daily_standup PASSED [ 64%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_generate_weekly_summary PASSED [ 64%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_breakdown_task_success PASSED [ 64%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_breakdown_task_not_complex PASSED [ 64%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_analyze_attendance_report PASSED [ 65%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_analyze_attendance_late_arrival PASSED [ 65%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_chat_method PASSED [ 65%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_call_api_with_json_mode PASSED [ 65%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_call_api_retry_on_error PASSED [ 65%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_format_preview PASSED [ 65%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_transcribe_voice_placeholder PASSED [ 66%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_breakdown_task_with_acceptance_criteria PASSED [ 66%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_analyze_task_with_conversation_history PASSED [ 66%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_generate_spec_parse_error_fallback PASSED [ 66%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_process_answer_parse_error_fallback PASSED [ 66%]
tests/unit/test_deepseek_integration.py::TestDeepSeekIntegration::test_analyze_attendance_multiple_people PASSED [ 66%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_post_task_to_channel_success PASSED [ 67%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_post_task_to_channel_network_error PASSED [ 67%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_route_to_department_dev PASSED [ 67%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_route_to_department_admin PASSED [ 67%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_route_to_department_marketing PASSED [ 67%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_route_to_department_design PASSED [ 67%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_route_to_department_unknown_defaults_dev PASSED [ 68%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_add_reaction_success PASSED [ 68%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_add_reaction_failure PASSED [ 68%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_create_thread_success PASSED [ 68%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_create_thread_failure PASSED [ 68%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_send_standup_report_success PASSED [ 68%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_send_standup_report_no_channel PASSED [ 69%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_send_notification_success PASSED [ 69%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_infer_role_from_task_keywords_dev PASSED [ 69%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_infer_role_from_task_keywords_marketing PASSED [ 69%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_infer_role_from_task_keywords_admin PASSED [ 69%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_post_spec_sheet_success PASSED [ 69%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_delete_task_message_success PASSED [ 70%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_send_message_success PASSED [ 70%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_send_message_with_embed PASSED [ 70%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_edit_message_success PASSED [ 70%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_get_assignee_role_from_sheets PASSED [ 70%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_get_assignee_role_not_found PASSED [ 70%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_post_weekly_summary PASSED [ 71%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_bulk_delete_threads PASSED [ 71%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_send_direct_message_to_team PASSED [ 71%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_post_task_update PASSED [ 71%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_api_request_retry_on_rate_limit PASSED [ 71%]
tests/unit/test_discord_integration.py::TestDiscordIntegration::test_get_configured_categories PASSED [ 71%]
tests/unit/test_encryption.py::TestTokenEncryption::test_encrypt_decrypt_round_trip PASSED [ 71%]
tests/unit/test_encryption.py::TestTokenEncryption::test_is_encrypted PASSED [ 72%]
tests/unit/test_encryption.py::TestTokenEncryption::test_decrypt_plaintext_token PASSED [ 72%]
tests/unit/test_encryption.py::TestTokenEncryption::test_convenience_functions PASSED [ 72%]
tests/unit/test_encryption.py::TestTokenEncryption::test_empty_string PASSED [ 72%]
tests/unit/test_encryption.py::TestTokenEncryption::test_long_token PASSED [ 72%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_can_handle_update_keyword PASSED [ 72%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_can_handle_change_keyword PASSED [ 73%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_can_handle_modify_keyword PASSED [ 73%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_can_handle_reassign_keyword PASSED [ 73%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_cannot_handle_non_modification PASSED [ 73%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_execute_modification_no_task_id PASSED [ 73%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_execute_modification_task_not_found PASSED [ 73%]
tests/unit/test_modification_handler.py::TestModificationHandler::test_execute_modification_success PASSED [ 74%]
tests/unit/test_oauth_repository_encryption.py::test_store_token_encrypts_data PASSED [ 74%]
tests/unit/test_oauth_repository_encryption.py::test_get_token_decrypts_data PASSED [ 74%]
tests/unit/test_oauth_repository_encryption.py::test_backward_compatibility_plaintext_tokens PASSED [ 74%]
tests/unit/test_oauth_repository_encryption.py::test_update_access_token_encrypts PASSED [ 74%]
tests/unit/test_oauth_repository_encryption.py::test_round_trip_encryption PASSED [ 74%]
tests/unit/test_oauth_repository_encryption.py::test_store_token_updates_existing_encrypted PASSED [ 75%]
tests/unit/test_query_handler.py::test_can_handle_status_query PASSED    [ 75%]
tests/unit/test_query_handler.py::test_can_handle_report_queries PASSED  [ 75%]
tests/unit/test_query_handler.py::test_can_handle_non_query PASSED       [ 75%]
tests/unit/test_query_handler.py::test_format_task_details PASSED        [ 75%]
tests/unit/test_query_handler.py::test_group_tasks_by_status PASSED      [ 75%]
tests/unit/test_query_handler.py::test_handle_task_lookup_success PASSED [ 76%]
tests/unit/test_query_handler.py::test_handle_task_lookup_not_found PASSED [ 76%]
tests/unit/test_query_handler.py::test_handle_my_tasks_empty PASSED      [ 76%]
tests/unit/test_query_handler.py::test_handle_overdue_tasks PASSED       [ 76%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_limits_admin PASSED [ 76%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_limits_webhook PASSED [ 76%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_limits_db_api PASSED [ 77%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_limits_general_api PASSED [ 77%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_limits_health_check PASSED [ 77%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_client_ip_forwarded PASSED [ 77%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_client_ip_real_ip PASSED [ 77%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_get_client_ip_direct PASSED [ 77%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_check_memory_within_limit PASSED [ 78%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_check_memory_exceeds_limit PASSED [ 78%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_check_memory_window_expiry PASSED [ 78%]
tests/unit/test_rate_limiting.py::TestRateLimitMiddleware::test_cleanup_memory PASSED [ 78%]
tests/unit/test_routing_handler.py::test_register_handler PASSED         [ 78%]
tests/unit/test_routing_handler.py::test_route_to_matching_handler PASSED [ 78%]
tests/unit/test_routing_handler.py::test_is_command PASSED               [ 79%]
tests/unit/test_routing_handler.py::test_extract_command PASSED          [ 79%]
tests/unit/test_routing_handler.py::test_active_handler_session PASSED   [ 79%]
tests/unit/test_routing_handler.py::test_fallback_to_ai_intent PASSED    [ 79%]
tests/unit/test_routing_handler.py::test_can_handle_always_true PASSED   [ 79%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_success PASSED     [ 79%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_no_tasks PASSED    [ 80%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_discord_failure PASSED [ 80%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_with_email_digest PASSED [ 80%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_email_digest_no_emails PASSED [ 80%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_ai_failure PASSED  [ 80%]
tests/unit/test_scheduler_jobs.py::test_daily_standup_sheets_failure PASSED [ 80%]
tests/unit/test_scheduler_jobs.py::test_weekly_summary_success PASSED    [ 81%]
tests/unit/test_scheduler_jobs.py::test_weekly_summary_no_overview PASSED [ 81%]
tests/unit/test_scheduler_jobs.py::test_weekly_summary_multiple_tasks PASSED [ 81%]
tests/unit/test_scheduler_jobs.py::test_weekly_summary_discord_failure PASSED [ 81%]
tests/unit/test_scheduler_jobs.py::test_weekly_summary_telegram_notification PASSED [ 81%]
tests/unit/test_scheduler_jobs.py::test_monthly_report_success PASSED    [ 81%]
tests/unit/test_scheduler_jobs.py::test_monthly_report_telegram_notification PASSED [ 82%]
tests/unit/test_scheduler_jobs.py::test_monthly_report_zero_tasks PASSED [ 82%]
tests/unit/test_scheduler_jobs.py::test_monthly_report_failure PASSED    [ 82%]
tests/unit/test_scheduler_jobs.py::test_deadline_reminder_success PASSED [ 82%]
tests/unit/test_scheduler_jobs.py::test_deadline_reminder_no_upcoming PASSED [ 82%]
tests/unit/test_scheduler_jobs.py::test_deadline_reminder_multiple_tasks PASSED [ 82%]
tests/unit/test_scheduler_jobs.py::test_deadline_reminder_failure PASSED [ 83%]
tests/unit/test_scheduler_jobs.py::test_deadline_reminder_boss_notification PASSED [ 83%]
tests/unit/test_scheduler_jobs.py::test_overdue_alert_success PASSED     [ 83%]
tests/unit/test_scheduler_jobs.py::test_overdue_alert_no_overdue PASSED  [ 83%]
tests/unit/test_scheduler_jobs.py::test_overdue_alert_multiple_tasks PASSED [ 83%]
tests/unit/test_scheduler_jobs.py::test_overdue_alert_failure PASSED     [ 83%]
tests/unit/test_scheduler_jobs.py::test_overdue_alert_boss_notification PASSED [ 84%]
tests/unit/test_scheduler_jobs.py::test_conversation_timeout_success PASSED [ 84%]
tests/unit/test_scheduler_jobs.py::test_conversation_timeout_no_timeouts PASSED [ 84%]
tests/unit/test_scheduler_jobs.py::test_conversation_auto_finalize PASSED [ 84%]
tests/unit/test_scheduler_jobs.py::test_conversation_timeout_failure PASSED [ 84%]
tests/unit/test_scheduler_jobs.py::test_archive_tasks_success PASSED     [ 84%]
tests/unit/test_scheduler_jobs.py::test_archive_tasks_no_tasks PASSED    [ 85%]
tests/unit/test_scheduler_jobs.py::test_archive_tasks_failure PASSED     [ 85%]
tests/unit/test_scheduler_jobs.py::test_recurring_tasks_success FAILED   [ 85%]
tests/unit/test_scheduler_jobs.py::test_recurring_tasks_no_due FAILED    [ 85%]
tests/unit/test_scheduler_jobs.py::test_recurring_tasks_multiple FAILED  [ 85%]
tests/unit/test_scheduler_jobs.py::test_recurring_tasks_creation_failure FAILED [ 85%]
tests/unit/test_scheduler_jobs.py::test_recurring_tasks_discord_post FAILED [ 85%]
tests/unit/test_scheduler_jobs.py::test_morning_email_digest_success PASSED [ 86%]
tests/unit/test_scheduler_jobs.py::test_morning_email_digest_no_emails PASSED [ 86%]
tests/unit/test_scheduler_jobs.py::test_evening_email_digest_success PASSED [ 86%]
tests/unit/test_scheduler_jobs.py::test_evening_email_digest_no_emails PASSED [ 86%]
tests/unit/test_scheduler_jobs.py::test_email_digest_initialization PASSED [ 86%]
tests/unit/test_scheduler_jobs.py::test_email_digest_failure_handling PASSED [ 86%]
tests/unit/test_scheduler_jobs.py::test_attendance_sync_success FAILED   [ 87%]
tests/unit/test_scheduler_jobs.py::test_attendance_sync_no_records FAILED [ 87%]
tests/unit/test_scheduler_jobs.py::test_attendance_sync_multiple_records FAILED [ 87%]
tests/unit/test_scheduler_jobs.py::test_attendance_sync_failure PASSED   [ 87%]
tests/unit/test_scheduler_jobs.py::test_weekly_time_report_success FAILED [ 87%]
tests/unit/test_scheduler_jobs.py::test_weekly_time_report_no_data FAILED [ 87%]
tests/unit/test_scheduler_jobs.py::test_weekly_time_report_with_late_days FAILED [ 88%]
tests/unit/test_scheduler_jobs.py::test_weekly_time_report_failure PASSED [ 88%]
tests/unit/test_scheduler_jobs.py::test_proactive_checkin_success FAILED [ 88%]
tests/unit/test_scheduler_jobs.py::test_proactive_checkin_no_stale_tasks PASSED [ 88%]
tests/unit/test_scheduler_jobs.py::test_proactive_checkin_skips_unassigned PASSED [ 88%]
tests/unit/test_scheduler_jobs.py::test_proactive_checkin_limits_to_five FAILED [ 88%]
tests/unit/test_scheduler_jobs.py::test_proactive_checkin_failure PASSED [ 89%]
tests/unit/test_scheduler_jobs.py::test_eod_reminder_success PASSED      [ 89%]
tests/unit/test_scheduler_jobs.py::test_eod_reminder_failure PASSED      [ 89%]
tests/unit/test_scheduler_jobs.py::test_eod_reminder_boss_notification PASSED [ 89%]
tests/unit/test_scheduler_jobs.py::test_notify_boss_of_failure PASSED    [ 89%]
tests/unit/test_scheduler_jobs.py::test_notify_boss_no_chat_id PASSED    [ 89%]
tests/unit/test_scheduler_jobs.py::test_notify_boss_truncates_long_errors PASSED [ 90%]
tests/unit/test_scheduler_jobs.py::test_trigger_job PASSED               [ 90%]
tests/unit/test_scheduler_jobs.py::test_get_job_status PASSED            [ 90%]
tests/unit/test_session_manager.py::test_in_memory_storage PASSED        [ 90%]
tests/unit/test_session_manager.py::test_redis_storage PASSED            [ 90%]
tests/unit/test_session_manager.py::test_all_session_types PASSED        [ 90%]
tests/unit/test_session_manager.py::test_ttl_in_memory PASSED            [ 91%]
tests/unit/test_session_manager.py::test_ttl_redis PASSED                [ 91%]
tests/unit/test_session_manager.py::test_concurrent_access PASSED        [ 91%]
tests/unit/test_session_manager.py::test_list_pending_validations PASSED [ 91%]
tests/unit/test_session_manager.py::test_session_stats PASSED            [ 91%]
tests/unit/test_session_manager.py::test_clear_all_sessions PASSED       [ 91%]
tests/unit/test_session_manager.py::test_clear_specific_type PASSED      [ 92%]
tests/unit/test_session_manager.py::test_invalid_json_handling PASSED    [ 92%]
tests/unit/test_session_manager.py::test_redis_failure_handling PASSED   [ 92%]
tests/unit/test_session_manager.py::test_singleton_pattern PASSED        [ 92%]
tests/unit/test_session_manager.py::test_init_session_manager PASSED     [ 92%]
tests/unit/test_session_manager.py::test_full_workflow PASSED            [ 92%]
tests/unit/test_session_manager.py::test_message_context_short_ttl PASSED [ 93%]
tests/unit/test_session_manager.py::test_high_volume_operations PASSED   [ 93%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_initialize_success PASSED [ 93%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_initialize_failure PASSED [ 93%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_add_task_success PASSED [ 93%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_add_task_not_initialized PASSED [ 93%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_update_task_success PASSED [ 94%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_update_task_not_found PASSED [ 94%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_task_success PASSED [ 94%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_task_not_found PASSED [ 94%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_delete_task_success PASSED [ 94%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_delete_task_header_protection PASSED [ 94%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_all_tasks PASSED [ 95%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_tasks_by_status PASSED [ 95%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_tasks_by_assignee PASSED [ 95%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_add_note PASSED [ 95%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_update_team_member PASSED [ 95%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_all_team_members PASSED [ 95%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_delete_team_member PASSED [ 96%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_generate_weekly_report PASSED [ 96%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_generate_monthly_report PASSED [ 96%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_archive_task PASSED [ 96%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_get_overdue_tasks PASSED [ 96%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_search_tasks_by_query PASSED [ 96%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_bulk_update_status PASSED [ 97%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_bulk_assign PASSED [ 97%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_delete_tasks_batch PASSED [ 97%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_add_attendance_log PASSED [ 97%]
tests/unit/test_sheets_integration.py::TestGoogleSheetsIntegration::test_clear_team_sheet PASSED [ 97%]
tests/unit/test_slowapi_limiter.py::test_create_limiter_with_redis PASSED [ 97%]
tests/unit/test_slowapi_limiter.py::test_create_limiter_without_redis PASSED [ 98%]
tests/unit/test_slowapi_limiter.py::test_setup_rate_limiting PASSED      [ 98%]
tests/unit/test_slowapi_limiter.py::test_limiter_enabled_by_default PASSED [ 98%]
tests/unit/test_slowapi_limiter.py::test_limiter_has_default_limits PASSED [ 98%]
tests/unit/test_validation_handler.py::test_can_handle_approve PASSED    [ 98%]
tests/unit/test_validation_handler.py::test_can_handle_reject PASSED     [ 98%]
tests/unit/test_validation_handler.py::test_can_handle_normal_message PASSED [ 99%]
tests/unit/test_validation_handler.py::test_handle_approve PASSED        [ 99%]
tests/unit/test_validation_handler.py::test_handle_approve_no_pending PASSED [ 99%]
tests/unit/test_validation_handler.py::test_request_validation PASSED    [ 99%]
tests/unit/test_validation_handler.py::test_handle_reject PASSED         [ 99%]
tests/unit/test_validation_handler.py::test_get_pending_validations PASSED [ 99%]
tests/unit/test_validation_handler.py::test_get_validation_count PASSED  [100%]

================================== FAILURES ===================================
___________________ test_create_conversation_error_handling ___________________
src\database\repositories\conversations.py:61: in create
    await session.flush()
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:2291: in _execute_mock_call
    raise effect
E   Exception: Database error

The above exception was the direct cause of the following exception:
tests\unit\repositories\test_conversations_repository.py:126: in test_create_conversation_error_handling
    result = await repo.create(user_id="123456789")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\conversations.py:73: in create
    raise DatabaseOperationError(f"Failed to create conversation: {e}") from e
E   src.database.exceptions.DatabaseOperationError: Failed to create conversation: Database error
------------------------------ Captured log call ------------------------------
ERROR    src.database.repositories.conversations:conversations.py:72 Error creating conversation: Database error
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\conversations.py", line 61, in create
    await session.flush()
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py", line 2291, in _execute_mock_call
    raise effect
Exception: Database error
___________________ test_add_message_conversation_not_found ___________________
tests\unit\repositories\test_conversations_repository.py:464: in test_add_message_conversation_not_found
    result = await repo.add_message(
src\database\repositories\conversations.py:252: in add_message
    raise EntityNotFoundError(f"Conversation {conversation_id} not found")
E   src.database.exceptions.EntityNotFoundError: Conversation CONV-nonexistent not found
____________________________ test_update_after_run ____________________________
tests\unit\repositories\test_recurring_repository.py:494: in test_update_after_run
    assert result is True
E   assert <src.database.models.RecurringTaskDB object at 0x00000277615DF9E0> is True
_______________________ test_update_after_run_not_found _______________________
tests\unit\repositories\test_recurring_repository.py:509: in test_update_after_run_not_found
    result = await repo.update_after_run("REC-nonexistent")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:339: in update_after_run
    raise EntityNotFoundError(f"Recurring task {recurring_id} not found")
E   src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
__________________________ test_pause_recurring_task __________________________
tests\unit\repositories\test_recurring_repository.py:530: in test_pause_recurring_task
    assert result is True
E   assert <src.database.models.RecurringTaskDB object at 0x00000277615CAB40> is True
____________________________ test_pause_not_found _____________________________
tests\unit\repositories\test_recurring_repository.py:544: in test_pause_not_found
    result = await repo.pause("REC-nonexistent")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:375: in pause
    raise EntityNotFoundError(f"Recurring task {recurring_id} not found")
E   src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
_________________________ test_resume_recurring_task __________________________
tests\unit\repositories\test_recurring_repository.py:562: in test_resume_recurring_task
    assert result is True
E   assert <src.database.models.RecurringTaskDB object at 0x000002776157BB30> is True
____________________________ test_resume_not_found ____________________________
tests\unit\repositories\test_recurring_repository.py:594: in test_resume_not_found
    result = await repo.resume("REC-nonexistent")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:405: in resume
    raise EntityNotFoundError(f"Recurring task {recurring_id} not found")
E   src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
____________________________ test_delete_not_found ____________________________
tests\unit\repositories\test_recurring_repository.py:629: in test_delete_not_found
    result = await repo.delete("REC-nonexistent")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:442: in delete
    raise EntityNotFoundError(f"Recurring task {recurring_id} not found")
E   src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
________________________ test_create_task_duplicate_id ________________________
src\database\repositories\tasks.py:66: in create
    await session.flush()
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:2291: in _execute_mock_call
    raise effect
E   Exception: Duplicate key

During handling of the above exception, another exception occurred:
tests\unit\repositories\test_task_repository.py:123: in test_create_task_duplicate_id
    result = await repo.create(task_data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\tasks.py:79: in create
    raise DatabaseOperationError(f"Failed to create task: {e}")
E   src.database.exceptions.DatabaseOperationError: Failed to create task: Duplicate key
------------------------------ Captured log call ------------------------------
ERROR    src.database.repositories.tasks:tasks.py:78 CRITICAL: Task creation failed: Duplicate key
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\tasks.py", line 66, in create
    await session.flush()
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py", line 2291, in _execute_mock_call
    raise effect
Exception: Duplicate key
_________________________ test_update_task_not_found __________________________
tests\unit\repositories\test_task_repository.py:251: in test_update_task_not_found
    result = await repo.update("TASK-999", {"title": "New title"})
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\tasks.py:128: in update
    raise EntityNotFoundError(f"Task {task_id} not found for update")
E   src.database.exceptions.EntityNotFoundError: Task TASK-999 not found for update
_________________________ test_delete_task_not_found __________________________
tests\unit\repositories\test_task_repository.py:304: in test_delete_task_not_found
    result = await repo.delete("TASK-999")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\tasks.py:158: in delete
    raise EntityNotFoundError(f"Task {task_id} not found for deletion")
E   src.database.exceptions.EntityNotFoundError: Task TASK-999 not found for deletion
________________________ test_recurring_tasks_success _________________________
src\database\repositories\recurring.py:309: in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:
tests\unit\test_scheduler_jobs.py:564: in test_recurring_tasks_success
    await scheduler_manager._recurring_tasks_job()
src\scheduler\jobs.py:573: in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:320: in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
E   src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.database.repositories.recurring:recurring.py:319 Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
ERROR    src.scheduler.jobs:jobs.py:621 CRITICAL: Recurring Tasks failed: Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 573, in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 320, in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
_________________________ test_recurring_tasks_no_due _________________________
src\database\repositories\recurring.py:309: in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:
tests\unit\test_scheduler_jobs.py:575: in test_recurring_tasks_no_due
    await scheduler_manager._recurring_tasks_job()
src\scheduler\jobs.py:573: in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:320: in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
E   src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.database.repositories.recurring:recurring.py:319 Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
ERROR    src.scheduler.jobs:jobs.py:621 CRITICAL: Recurring Tasks failed: Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 573, in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 320, in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
________________________ test_recurring_tasks_multiple ________________________
src\database\repositories\recurring.py:309: in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:
tests\unit\test_scheduler_jobs.py:603: in test_recurring_tasks_multiple
    await scheduler_manager._recurring_tasks_job()
src\scheduler\jobs.py:573: in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:320: in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
E   src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.database.repositories.recurring:recurring.py:319 Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
ERROR    src.scheduler.jobs:jobs.py:621 CRITICAL: Recurring Tasks failed: Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 573, in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 320, in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
____________________ test_recurring_tasks_creation_failure ____________________
src\database\repositories\recurring.py:309: in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:
tests\unit\test_scheduler_jobs.py:629: in test_recurring_tasks_creation_failure
    await scheduler_manager._recurring_tasks_job()
src\scheduler\jobs.py:573: in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:320: in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
E   src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.database.repositories.recurring:recurring.py:319 Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
ERROR    src.scheduler.jobs:jobs.py:621 CRITICAL: Recurring Tasks failed: Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 573, in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 320, in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
______________________ test_recurring_tasks_discord_post ______________________
src\database\repositories\recurring.py:309: in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:
tests\unit\test_scheduler_jobs.py:652: in test_recurring_tasks_discord_post
    await scheduler_manager._recurring_tasks_job()
src\scheduler\jobs.py:573: in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\recurring.py:320: in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
E   src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.database.repositories.recurring:recurring.py:319 Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
ERROR    src.scheduler.jobs:jobs.py:621 CRITICAL: Recurring Tasks failed: Failed to get due recurring tasks: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 309, in get_due_now
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 573, in _recurring_tasks_job
    due_tasks = await recurring_repo.get_due_now()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\recurring.py", line 320, in get_due_now
    raise DatabaseOperationError(f"Failed to get due recurring tasks: {e}") from e
src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
________________________ test_attendance_sync_success _________________________
tests\unit\test_scheduler_jobs.py:786: in test_attendance_sync_success
    await scheduler_manager._sync_attendance_job()
src\scheduler\jobs.py:735: in _sync_attendance_job
    unsynced = await attendance_repo.get_unsynced_records(limit=100)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\attendance.py:375: in get_unsynced_records
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.scheduler.jobs:jobs.py:775 CRITICAL: Attendance Sync failed: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 735, in _sync_attendance_job
    unsynced = await attendance_repo.get_unsynced_records(limit=100)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\attendance.py", line 375, in get_unsynced_records
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
_______________________ test_attendance_sync_no_records _______________________
tests\unit\test_scheduler_jobs.py:799: in test_attendance_sync_no_records
    await scheduler_manager._sync_attendance_job()
src\scheduler\jobs.py:735: in _sync_attendance_job
    unsynced = await attendance_repo.get_unsynced_records(limit=100)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\attendance.py:375: in get_unsynced_records
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.scheduler.jobs:jobs.py:775 CRITICAL: Attendance Sync failed: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 735, in _sync_attendance_job
    unsynced = await attendance_repo.get_unsynced_records(limit=100)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\attendance.py", line 375, in get_unsynced_records
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
____________________ test_attendance_sync_multiple_records ____________________
tests\unit\test_scheduler_jobs.py:828: in test_attendance_sync_multiple_records
    await scheduler_manager._sync_attendance_job()
src\scheduler\jobs.py:735: in _sync_attendance_job
    unsynced = await attendance_repo.get_unsynced_records(limit=100)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\attendance.py:375: in get_unsynced_records
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.scheduler.jobs:jobs.py:775 CRITICAL: Attendance Sync failed: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 735, in _sync_attendance_job
    unsynced = await attendance_repo.get_unsynced_records(limit=100)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\attendance.py", line 375, in get_unsynced_records
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
_______________________ test_weekly_time_report_success _______________________
tests\unit\test_scheduler_jobs.py:874: in test_weekly_time_report_success
    await scheduler_manager._weekly_time_report_job()
src\scheduler\jobs.py:796: in _weekly_time_report_job
    summaries = await attendance_repo.get_team_weekly_summary(last_monday)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\attendance.py:343: in get_team_weekly_summary
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.scheduler.jobs:jobs.py:857 CRITICAL: Weekly Time Report failed: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 796, in _weekly_time_report_job
    summaries = await attendance_repo.get_team_weekly_summary(last_monday)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\attendance.py", line 343, in get_team_weekly_summary
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
_______________________ test_weekly_time_report_no_data _______________________
tests\unit\test_scheduler_jobs.py:888: in test_weekly_time_report_no_data
    await scheduler_manager._weekly_time_report_job()
src\scheduler\jobs.py:796: in _weekly_time_report_job
    summaries = await attendance_repo.get_team_weekly_summary(last_monday)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\attendance.py:343: in get_team_weekly_summary
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.scheduler.jobs:jobs.py:857 CRITICAL: Weekly Time Report failed: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 796, in _weekly_time_report_job
    summaries = await attendance_repo.get_team_weekly_summary(last_monday)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\attendance.py", line 343, in get_team_weekly_summary
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
___________________ test_weekly_time_report_with_late_days ____________________
tests\unit\test_scheduler_jobs.py:915: in test_weekly_time_report_with_late_days
    await scheduler_manager._weekly_time_report_job()
src\scheduler\jobs.py:796: in _weekly_time_report_job
    summaries = await attendance_repo.get_team_weekly_summary(last_monday)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\database\repositories\attendance.py:343: in get_team_weekly_summary
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\contextlib.py:210: in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
src\database\connection.py:153: in session
    ???
E   RuntimeError: Database not initialized
------------------------------ Captured log call ------------------------------
WARNING  src.database.connection:connection.py:39 DATABASE_URL not configured
ERROR    src.scheduler.jobs:jobs.py:857 CRITICAL: Weekly Time Report failed: Database not initialized
Traceback (most recent call last):
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\scheduler\jobs.py", line 796, in _weekly_time_report_job
    summaries = await attendance_repo.get_team_weekly_summary(last_monday)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\repositories\attendance.py", line 343, in get_team_weekly_summary
    async with self.db.session() as session:
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\User\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\User\Desktop\ACCWARE.AI\AUTOMATION\boss-workflow\src\database\connection.py", line 153, in session
RuntimeError: Database not initialized
_______________________ test_proactive_checkin_success ________________________
tests\unit\test_scheduler_jobs.py:961: in test_proactive_checkin_success
    scheduler_manager.discord.post_alert.assert_called()
..\..\..\..\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:918: in assert_called
    raise AssertionError(msg)
E   AssertionError: Expected 'post_alert' to have been called.
------------------------------ Captured log call ------------------------------
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-001: object NoneType can't be used in 'await' expression
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-001: object NoneType can't be used in 'await' expression
____________________ test_proactive_checkin_limits_to_five ____________________
tests\unit\test_scheduler_jobs.py:1024: in test_proactive_checkin_limits_to_five
    assert scheduler_manager.discord.post_alert.call_count == 5
E   AssertionError: assert 0 == 5
E    +  where 0 = <AsyncMock name='mock.post_alert' id='2711759925616'>.call_count
E    +    where <AsyncMock name='mock.post_alert' id='2711759925616'> = <AsyncMock id='2711765025184'>.post_alert
E    +      where <AsyncMock id='2711765025184'> = <src.scheduler.jobs.SchedulerManager object at 0x0000027762DD18E0>.discord
------------------------------ Captured log call ------------------------------
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-000: object NoneType can't be used in 'await' expression
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-001: object NoneType can't be used in 'await' expression
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-002: object NoneType can't be used in 'await' expression
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-003: object NoneType can't be used in 'await' expression
ERROR    src.scheduler.jobs:jobs.py:1008 Error sending check-in for TASK-004: object NoneType can't be used in 'await' expression

---------- coverage: platform win32, python 3.12.10-final-0 ----------
Name                                         Stmts   Miss  Cover
----------------------------------------------------------------
src\__init__.py                                  1      0   100%
src\ai\__init__.py                               7      0   100%
src\ai\clarifier.py                            538    501     7%
src\ai\deepseek.py                             107     12    89%
src\ai\email_summarizer.py                     114     86    25%
src\ai\intent.py                               293    224    24%
src\ai\prompts.py                               55      4    93%
src\ai\reviewer.py                             136     99    27%
src\ai\staff_assistant.py                      193    193     0%
src\ai\task_processor.py                       206    206     0%
src\ai\transcriber.py                           78     78     0%
src\ai\vision.py                                60     60     0%
src\bot\__init__.py                              5      0   100%
src\bot\base_handler.py                         74      7    91%
src\bot\commands.py                            639    639     0%
src\bot\conversation.py                        180    146    19%
src\bot\handler.py                            1713   1601     7%
src\bot\handlers\__init__.py                     8      0   100%
src\bot\handlers\approval_handler.py           158     43    73%
src\bot\handlers\command_handler.py             75     11    85%
src\bot\handlers\modification_handler.py        50     19    62%
src\bot\handlers\query_handler.py              305    209    31%
src\bot\handlers\routing_handler.py            119     48    60%
src\bot\handlers\unified_wrapper.py             39     24    38%
src\bot\handlers\validation_handler.py         191     65    66%
src\bot\session_manager.py                     407    111    73%
src\bot\staff_handler.py                       181    181     0%
src\bot\telegram.py                            362    362     0%
src\bot\telegram_simple.py                     161    125    22%
src\bot\validation.py                          214    165    23%
src\cache\__init__.py                            4      4     0%
src\cache\decorators.py                         70     70     0%
src\cache\redis_client.py                      128    128     0%
src\database\__init__.py                         3      0   100%
src\database\connection.py                     144    125    13%
src\database\exceptions.py                      12      0   100%
src\database\models.py                         384      0   100%
src\database\repositories\__init__.py           10      0   100%
src\database\repositories\ai_memory.py         131     18    86%
src\database\repositories\attendance.py        204    170    17%
src\database\repositories\audit.py             118     10    92%
src\database\repositories\conversations.py     148     25    83%
src\database\repositories\oauth.py             112     45    60%
src\database\repositories\projects.py          110     28    75%
src\database\repositories\recurring.py         268     53    80%
src\database\repositories\staff_context.py     176    138    22%
src\database\repositories\tasks.py             282    114    60%
src\database\repositories\team.py              113     38    66%
src\database\repositories\time_tracking.py     181    181     0%
src\database\sync.py                            95     74    22%
src\integrations\__init__.py                     8      0   100%
src\integrations\calendar.py                   238     50    79%
src\integrations\discord.py                    654    272    58%
src\integrations\discord_bot.py                501    456     9%
src\integrations\drive.py                      151    121    20%
src\integrations\gmail.py                      268    193    28%
src\integrations\meet.py                        99     75    24%
src\integrations\sheets.py                     678    303    55%
src\integrations\tasks.py                      233    196    16%
src\main.py                                    797    450    44%
src\memory\__init__.py                           4      0   100%
src\memory\context.py                          164    131    20%
src\memory\learning.py                         145    121    17%
src\memory\pattern_learning.py                 188    188     0%
src\memory\preferences.py                      196    122    38%
src\memory\task_context.py                     280    218    22%
src\middleware\rate_limit.py                   104     42    60%
src\middleware\slowapi_limiter.py               31     11    65%
src\models\__init__.py                           4      0   100%
src\models\api_validation.py                   132      4    97%
src\models\conversation.py                      90     26    71%
src\models\task.py                             148     47    68%
src\models\validation.py                       129     59    54%
src\monitoring\__init__.py                       3      3     0%
src\monitoring\alerts.py                        67     67     0%
src\monitoring\middleware.py                    24     24     0%
src\monitoring\prometheus.py                    28     28     0%
src\scheduler\__init__.py                        3      0   100%
src\scheduler\health_checks.py                  71     71     0%
src\scheduler\jobs.py                          442    151    66%
src\scheduler\reminders.py                     166    135    19%
src\services\__init__.py                         2      0   100%
src\services\attendance.py                     302    273    10%
src\services\message_queue.py                  157    157     0%
src\services\rate_limiter.py                   110    110     0%
src\utils\__init__.py                            4      0   100%
src\utils\audit_logger.py                       70     33    53%
src\utils\background_tasks.py                   26     10    62%
src\utils\datetime_utils.py                     69     57    17%
src\utils\encryption.py                         56      8    86%
src\utils\retry.py                              58     22    62%
src\utils\team_utils.py                         77     61    21%
src\utils\validation.py                         78     55    29%
src\web\__init__.py                              2      0   100%
src\web\routes.py                              199    158    21%
----------------------------------------------------------------
TOTAL                                        16618  10948    34%
Coverage HTML written to dir htmlcov

=========================== short test summary info ===========================
FAILED tests/unit/repositories/test_conversations_repository.py::test_create_conversation_error_handling - src.database.exceptions.DatabaseOperationError: Failed to create conversation: Database error
FAILED tests/unit/repositories/test_conversations_repository.py::test_add_message_conversation_not_found - src.database.exceptions.EntityNotFoundError: Conversation CONV-nonexistent not found
FAILED tests/unit/repositories/test_recurring_repository.py::test_update_after_run - assert <src.database.models.RecurringTaskDB object at 0x00000277615DF9E0> is True
FAILED tests/unit/repositories/test_recurring_repository.py::test_update_after_run_not_found - src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
FAILED tests/unit/repositories/test_recurring_repository.py::test_pause_recurring_task - assert <src.database.models.RecurringTaskDB object at 0x00000277615CAB40> is True
FAILED tests/unit/repositories/test_recurring_repository.py::test_pause_not_found - src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
FAILED tests/unit/repositories/test_recurring_repository.py::test_resume_recurring_task - assert <src.database.models.RecurringTaskDB object at 0x000002776157BB30> is True
FAILED tests/unit/repositories/test_recurring_repository.py::test_resume_not_found - src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
FAILED tests/unit/repositories/test_recurring_repository.py::test_delete_not_found - src.database.exceptions.EntityNotFoundError: Recurring task REC-nonexistent not found
FAILED tests/unit/repositories/test_task_repository.py::test_create_task_duplicate_id - src.database.exceptions.DatabaseOperationError: Failed to create task: Duplicate key
FAILED tests/unit/repositories/test_task_repository.py::test_update_task_not_found - src.database.exceptions.EntityNotFoundError: Task TASK-999 not found for update
FAILED tests/unit/repositories/test_task_repository.py::test_delete_task_not_found - src.database.exceptions.EntityNotFoundError: Task TASK-999 not found for deletion
FAILED tests/unit/test_scheduler_jobs.py::test_recurring_tasks_success - src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_recurring_tasks_no_due - src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_recurring_tasks_multiple - src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_recurring_tasks_creation_failure - src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_recurring_tasks_discord_post - src.database.exceptions.DatabaseOperationError: Failed to get due recurring tasks: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_attendance_sync_success - RuntimeError: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_attendance_sync_no_records - RuntimeError: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_attendance_sync_multiple_records - RuntimeError: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_weekly_time_report_success - RuntimeError: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_weekly_time_report_no_data - RuntimeError: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_weekly_time_report_with_late_days - RuntimeError: Database not initialized
FAILED tests/unit/test_scheduler_jobs.py::test_proactive_checkin_success - AssertionError: Expected 'post_alert' to have been called.
FAILED tests/unit/test_scheduler_jobs.py::test_proactive_checkin_limits_to_five - AssertionError: assert 0 == 5
 +  where 0 = <AsyncMock name='mock.post_alert' id='2711759925616'>.call_count
 +    where <AsyncMock name='mock.post_alert' id='2711759925616'> = <AsyncMock id='2711765025184'>.post_alert
 +      where <AsyncMock id='2711765025184'> = <src.scheduler.jobs.SchedulerManager object at 0x0000027762DD18E0>.discord
=========== 25 failed, 582 passed, 83 warnings in 81.30s (0:01:21) ============
